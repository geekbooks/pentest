/*
 *  network/examples/raw-socket.c
 * 
 *  Copyleft (C) 2015  Sun Dro (a.k.a 7th Ghost)
 *
 * Example source code of RAW Socket Usage.
 */

/* C includes*/
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <errno.h>

/* Linux includes */
#include <sys/socket.h>
#include <arpa/inet.h>

#define MAXMSG 512

int main()
{
    int sock, data, size;
    struct sockaddr addr;
    unsigned char buf[MAXMSG];

    /* Create raw socket */
    sock = socket(AF_INET , SOCK_RAW , IPPROTO_TCP);
    if (sock < 0) 
    {
        perror("raw-socket");
        return 0;
    }
    
    /* Get packet size */
    size = sizeof addr;

    /* Get packet */
    data = recvfrom(sock, buf, sizeof(buf), 0, &addr, (socklen_t *)&size);
    if(data < 0)
    {
        printf("Can not get packet\n");
        close(sock);
        return 0;
    }
    else printf("%s\n", buf);

    /* Thats all folks */
    close(sock);
    return 0;
}